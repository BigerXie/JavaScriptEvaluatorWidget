$("body").append('<script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js">\x3c/script>');
TW.IDE.Dialogs.JavaScriptEvaluatorCustomEditor=function(){var a=(new Date).getTime()+"_"+Math.floor(1E3*Math.random());this.title="JavaScript Code";var c,d;this.renderDialogHtml=function(b){c=b.properties.code;b=9>=parseFloat(TWX.App.version)?"width:100%;height:100%":"width:98%;height:96%";return"<textarea class='JavaScriptEvaluatorCustomEditor_"+a+"' style='"+b+";visibility:hidden;resize:none;position:absolute;font-size:14px;font-family:monospaced;white-space:nowrap'>"+(c?c:"")+"</textarea><div id='JavaScriptEvaluatorCustomEditor_"+
a+"' style='"+b+";resize:none;position:absolute'></div>"};this.afterRender=function(b){try{require.config({paths:{vs:"https://unpkg.com/monaco-editor@latest/min/vs"}});window.MonacoEnvironment={getWorkerUrl:()=>e};var e=URL.createObjectURL(new Blob(["\n        self.MonacoEnvironment = {baseUrl: 'https://unpkg.com/monaco-editor@latest/min/'};\n        importScripts('https://unpkg.com/monaco-editor@latest/min/vs/base/worker/workerMain.js');\n      "],{type:"text/javascript"}));require(["vs/editor/editor.main"],
function(){try{d=monaco.editor.create(document.getElementById("JavaScriptEvaluatorCustomEditor_"+a),{value:c?c:"",language:"javascript",theme:"vs"})}catch(f){d=null,$("#JavaScriptEvaluatorCustomEditor_"+a).css("visibility","hidden"),$(".JavaScriptEvaluatorCustomEditor_"+a).css("visibility","visible")}})}catch(f){d=null,$("#JavaScriptEvaluatorCustomEditor_"+a).css("visibility","hidden"),$(".JavaScriptEvaluatorCustomEditor_"+a).css("visibility","visible")}};this.updateProperties=function(b){b.setProperty("code",
d?d.getValue():$(".JavaScriptEvaluatorCustomEditor_"+a).val());return!0}};
TW.IDE.Widgets.javascriptevaluator=function(){this.widgetIconUrl=function(){return"../Common/extensions/JavaScriptEvaluatorWidget/ui/javascriptevaluator/js.png"};this.widgetProperties=function(){return{name:"JavaScriptEvaluator",description:"Widget to execute JavaScript code without any restriction",category:["Common"],iconImage:"js.png",customEditor:"JavaScriptEvaluatorCustomEditor",customEditorMenuText:"Edit JavaScript Code",properties:{Width:{description:"width",defaultValue:200},Height:{description:"height",
defaultValue:28},inputParameters:{baseType:"JSON",defaultValue:"{}",description:'The JSON object describing the input parameters having parameter names as key and data type as value; ex. {"minTemp": "STRING"}'},code:{isVisible:!0,baseType:"STRING",isBindingTarget:!0,isEditable:!0,description:"The JavaScript code to execute"},debugMode:{isVisible:!0,baseType:"BOOLEAN",isEditable:!0,defaultValue:!1,description:"true to activate the debug"},resultType:{isVisible:!0,baseType:"STRING",isEditable:!0,description:"The (optional) result type of the executed JavaScript code",
defaultValue:"NOTHING",selectOptions:[{value:"NOTHING",text:"Nothing"},{value:"STRING",text:"String"},{value:"INTEGER",text:"Integer"},{value:"NUMBER",text:"Number"},{value:"DATETIME",text:"DateTime"},{value:"BOOLEAN",text:"Boolean"}]}}}};this.widgetServices=function(){return{Evaluate:{warnIfNotBound:!0}}};this.widgetEvents=function(){return{Evaluated:{}}};this.renderHtml=function(){return'<div class="widget-content widget-javascriptevaluator"><span class="javascriptevaluator-property">JavaScript Evaluator</span></div>'};
this.afterRender=function(){this.setProperty("_InputParametersDataShape","{}");this.addNewInputParameters(this.getProperty("inputParameters"));this.manageResultType()};this.afterSetProperty=function(a,c){"inputParameters"===a?(this.deleteOldInputParameters(),""===c?this.resetJSON(a):this.addNewInputParameters(c)||(TW.IDE.showStatusText("error","inputParameters: the JSON object is not valid, or one of the parameter names is reserved, or a type other than STRING, INTEGER, NUMBER, DATETIME, BOOLEAN, INFOTABLE has been indicated."),
this.resetJSON(a))):"resultType"===a&&this.manageResultType();return!1};this.deleteOldInputParameters=function(){var a=this.allWidgetProperties().properties,c=this.strToJson(this.getProperty("_InputParametersDataShape")),d;for(d in c)delete a[d]};this.addNewInputParameters=function(a){var c=this.allWidgetProperties().properties;a=this.strToJson(a);var d="STRING INTEGER NUMBER DATETIME BOOLEAN INFOTABLE".split(" "),b;for(b in a)if(a.hasOwnProperty(b)&&c[b]||-1===d.indexOf(a[b]))return this.setProperty("_InputParametersDataShape",
"{}"),!1;for(b in a)c[b]={isBaseProperty:!1,name:b,type:"property",isVisible:!0,isBindingTarget:!0,baseType:a[b]},"STRING"===a[b]&&(c[b].isLocalizable=!0);this.setProperty("_InputParametersDataShape",this.jsonToStr(this.getProperty("inputParameters")));this.updatedProperties({updateUI:!0});return!0};this.jsonToStr=function(a){a?"string"!==typeof a&&(a=JSON.stringify(a)):a="{}";return a};this.strToJson=function(a){a?"string"===typeof a&&(a=JSON.parse(a)):a={};return a};this.resetJSON=function(a){this.setProperty(a,
"{}");TW.IDE.updateWidgetPropertiesWindow()};this.manageResultType=function(){var a=this.allWidgetProperties().properties;delete a.result;var c=this.getProperty("resultType");"NOTHING"!==c&&(a.result={isBaseProperty:!1,name:"result",type:"property",isVisible:!0,isEditable:!1,isBindingSource:!0,baseType:c,description:"The (optional) result of the executed JavaScript code"});this.updatedProperties({updateUI:!0})}};