$("body").append('<script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js">\x3c/script>');
TW.IDE.Dialogs.JavaScriptEvaluatorCustomEditor=function(){function a(){try{e=monaco.editor.create(document.getElementById("JavaScriptEvaluatorCustomEditor_"+b),{value:d?d:"",language:"javascript",scrollBeyondLastLine:!1,theme:"vs"}),$(".JavaScriptEvaluatorCustomEditor_"+b+"_inputParameter").click(function(){for(var f=[],a=e.getSelections(),b=0;b<a.length;b++)f.push({identifier:{major:1,minor:1},range:a[b],text:$(this).attr("key"),forceMoveMarkers:!0});e.executeEdits("my-source",f)}),$(".JavaScriptEvaluatorCustomEditor_"+
b+"_result").click(function(){for(var a=[],b=e.getSelections(),c=0;c<b.length;c++)a.push({identifier:{major:1,minor:1},range:b[c],text:"result",forceMoveMarkers:!0});e.executeEdits("my-source",a)}),$(".JavaScriptEvaluatorCustomEditor_"+b+"_triggerCustomEvent").click(function(){for(var a=[],b=e.getSelections(),c=0;c<b.length;c++)a.push({identifier:{major:1,minor:1},range:b[c],text:"triggerCustomEvent(<INSERT CUSTOM EVENT INDEX HERE>);",forceMoveMarkers:!0});e.executeEdits("my-source",a)})}catch(f){e=
null,$("#JavaScriptEvaluatorCustomEditor_"+b).css("visibility","hidden"),$(".JavaScriptEvaluatorCustomEditor_"+b).css("visibility","visible"),c()}}function c(){$(".JavaScriptEvaluatorCustomEditor_"+b+"_inputParameter").click(function(){var a=document.getElementsByClassName("JavaScriptEvaluatorCustomEditor_"+b)[0];a.value=a.value.substring(0,a.selectionStart)+$(this).attr("key")+a.value.substring(a.selectionEnd,a.value.length)});$(".JavaScriptEvaluatorCustomEditor_"+b+"_result").click(function(){var a=
document.getElementsByClassName("JavaScriptEvaluatorCustomEditor_"+b)[0];a.value=a.value.substring(0,a.selectionStart)+"result"+a.value.substring(a.selectionEnd,a.value.length)});$(".JavaScriptEvaluatorCustomEditor_"+b+"_triggerCustomEvent").click(function(){var a=document.getElementsByClassName("JavaScriptEvaluatorCustomEditor_"+b)[0];a.value=a.value.substring(0,a.selectionStart)+"triggerCustomEvent(<INSERT CUSTOM EVENT INDEX HERE>);"+a.value.substring(a.selectionEnd,a.value.length)})}var b=(new Date).getTime()+
"_"+Math.floor(1E3*Math.random());this.title="JavaScript Code";var d,e;this.renderDialogHtml=function(a){d=a.properties.code;var c=this.strToJson(a.properties.inputParameters),f="",e;for(e in c)f+="<span class='JavaScriptEvaluatorCustomEditor_"+b+"_inputParameter' style='display:block;padding:5px;white-space:nowrap;cursor:pointer' key='"+e+"'><b>"+e+"</b>: "+c[e]+"</span>";f+="<hr/><span class='JavaScriptEvaluatorCustomEditor_"+b+"_result' style='display:block;padding:5px;white-space:nowrap;cursor:pointer'><b>result</b>: "+
a.properties.resultType+"</span>";f+="<hr/><span class='JavaScriptEvaluatorCustomEditor_"+b+"_triggerCustomEvent' style='display:block;padding:5px;white-space:nowrap;cursor:pointer'><b>triggerCustomEvent</b></span>";a=9>=parseFloat(TWX.App.version)?"width:15%;height:100%":"width:15%;height:96%";c=9>=parseFloat(TWX.App.version)?"width:84%;height:100%":"width:82%;height:96%";return"<div style='"+a+";position:absolute;overflow:auto;border:1px solid gray'>"+f+"</div><textarea class='JavaScriptEvaluatorCustomEditor_"+
b+"' style='"+c+";visibility:hidden;resize:none;position:absolute;left:16%;font-size:14px;font-family:monospaced;white-space:nowrap'>"+(d?d:"")+"</textarea><div id='JavaScriptEvaluatorCustomEditor_"+b+"' style='"+c+";resize:none;position:absolute;left:16%'></div>"};this.afterRender=function(f){try{if(window.monaco&&monaco.editor)a();else{require.config({paths:{vs:"https://unpkg.com/monaco-editor@latest/min/vs"}});window.MonacoEnvironment={getWorkerUrl:()=>d};var d=URL.createObjectURL(new Blob(["\n          self.MonacoEnvironment = {baseUrl: 'https://unpkg.com/monaco-editor@latest/min/'};\n          importScripts('https://unpkg.com/monaco-editor@latest/min/vs/base/worker/workerMain.js');\n        "],
{type:"text/javascript"}));require(["vs/editor/editor.main"],a)}}catch(g){e=null,$("#JavaScriptEvaluatorCustomEditor_"+b).css("visibility","hidden"),$(".JavaScriptEvaluatorCustomEditor_"+b).css("visibility","visible"),c()}};this.updateProperties=function(a){a.setProperty("code",e?e.getValue():$(".JavaScriptEvaluatorCustomEditor_"+b).val());return!0};this.strToJson=function(a){a?"string"===typeof a&&(a=JSON.parse(a)):a={};return a}};
TW.IDE.Widgets.javascriptevaluator=function(){this.widgetIconUrl=function(){return"../Common/extensions/JavaScriptEvaluatorWidget/ui/javascriptevaluator/js.png"};this.widgetProperties=function(){return{name:"JavaScriptEvaluator",description:"Widget to execute JavaScript code without any restriction",category:["Common"],iconImage:"js.png",customEditor:"JavaScriptEvaluatorCustomEditor",customEditorMenuText:"Edit JavaScript Code",properties:{Width:{description:"width",defaultValue:200},Height:{description:"height",
defaultValue:28},inputParameters:{baseType:"JSON",defaultValue:"{}",description:'The JSON object describing the input parameters having parameter names as key and data type as value; ex. {"minTemp": "STRING"}'},code:{isVisible:!0,baseType:"STRING",isBindingTarget:!0,isEditable:!0,description:"The JavaScript code to execute"},debugMode:{isVisible:!0,baseType:"BOOLEAN",isEditable:!0,defaultValue:!1,description:"true to activate the debug"},resultType:{isVisible:!0,baseType:"STRING",isEditable:!0,description:"The (optional) result type of the executed JavaScript code",
defaultValue:"NOTHING",selectOptions:[{value:"NOTHING",text:"Nothing"},{value:"STRING",text:"String"},{value:"INTEGER",text:"Integer"},{value:"NUMBER",text:"Number"},{value:"DATETIME",text:"DateTime"},{value:"BOOLEAN",text:"Boolean"}]},numberOfCustomEvents:{isVisible:!0,baseType:"INTEGER",isEditable:!0,defaultValue:0,description:"The number of custom events"}}}};this.widgetServices=function(){return{Evaluate:{warnIfNotBound:!0}}};this.widgetEvents=function(){return{Evaluated:{}}};this.renderHtml=
function(){return'<div class="widget-content widget-javascriptevaluator"><span class="javascriptevaluator-property">JavaScript Evaluator</span></div>'};this.afterRender=function(){this.setProperty("_InputParametersDataShape","{}");this.addNewInputParameters(this.getProperty("inputParameters"));this.manageResultType();this.addNewEventParameters(this.getProperty("numberOfCustomEvents"))};this.afterSetProperty=function(a,c){"inputParameters"===a?(this.deleteOldInputParameters(),""===c?this.resetJSON(a):
this.addNewInputParameters(c)||(TW.IDE.showStatusText("error","inputParameters: the JSON object is not valid, or one of the parameter names is reserved, or a type other than STRING, INTEGER, NUMBER, DATETIME, BOOLEAN, INFOTABLE has been indicated."),this.resetJSON(a))):"resultType"===a?this.manageResultType():"numberOfCustomEvents"===a&&(this.deleteOldEventParameters(),this.addNewEventParameters(c));return!1};this.deleteOldInputParameters=function(){var a=this.allWidgetProperties().properties,c=this.strToJson(this.getProperty("_InputParametersDataShape")),
b;for(b in c)delete a[b]};this.addNewInputParameters=function(a){var c=this.allWidgetProperties().properties;a=this.strToJson(a);var b="STRING INTEGER NUMBER DATETIME BOOLEAN INFOTABLE".split(" "),d;for(d in a)if(a.hasOwnProperty(d)&&c[d]||-1===b.indexOf(a[d]))return this.setProperty("_InputParametersDataShape","{}"),!1;for(d in a)c[d]={isBaseProperty:!1,name:d,type:"property",isVisible:!0,isBindingTarget:!0,baseType:a[d]},"STRING"===a[d]&&(c[d].isLocalizable=!0);this.setProperty("_InputParametersDataShape",
this.jsonToStr(this.getProperty("inputParameters")));this.updatedProperties({updateUI:!0});return!0};this.jsonToStr=function(a){a?"string"!==typeof a&&(a=JSON.stringify(a)):a="{}";return a};this.strToJson=function(a){a?"string"===typeof a&&(a=JSON.parse(a)):a={};return a};this.resetJSON=function(a){this.setProperty(a,"{}");TW.IDE.updateWidgetPropertiesWindow()};this.manageResultType=function(){var a=this.allWidgetProperties().properties;delete a.result;var c=this.getProperty("resultType");"NOTHING"!==
c&&(a.result={isBaseProperty:!1,name:"result",type:"property",isVisible:!0,isEditable:!1,isBindingSource:!0,baseType:c,description:"The (optional) result of the executed JavaScript code"});this.updatedProperties({updateUI:!0})};this.deleteOldEventParameters=function(){var a=this.allWidgetProperties().properties,c;for(c in a)c.toLowerCase().startsWith("customevent")&&delete a[c]};this.addNewEventParameters=function(a){for(var c=this.allWidgetProperties().properties,b=1;b<=a;b++)c["CustomEvent"+b]=
{name:"CustomEvent"+b,type:"event",description:"CustomEvent N. "+b,isVisible:!0};this.updatedProperties({updateUI:!0})}};