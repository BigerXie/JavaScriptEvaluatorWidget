TW.IDE.Dialogs.JavaScriptEvaluatorCustomEditor=function(){var a=(new Date).getTime()+"_"+Math.floor(1E3*Math.random());this.title="JavaScript Code";this.renderDialogHtml=function(b){var d=9>=parseFloat(TWX.App.version)?"width:100%;height:100%":"width:98%;height:96%";b=b.properties.code;return"<textarea class='JavaScriptEvaluatorCustomEditor_"+a+"' style='"+d+";resize:none;position:absolute;font-size:14px;font-family:monospaced;white-space:nowrap'>"+(b?b:"")+"</textarea>"};this.afterRender=function(a){};
this.updateProperties=function(b){b.setProperty("code",$(".JavaScriptEvaluatorCustomEditor_"+a).val());return!0}};
TW.IDE.Widgets.javascriptevaluator=function(){this.widgetIconUrl=function(){return"../Common/extensions/JavaScriptEvaluatorWidget/ui/javascriptevaluator/js.png"};this.widgetProperties=function(){return{name:"JavaScriptEvaluator",description:"Widget to execute JavaScript code without any restriction",category:["Common"],iconImage:"js.png",customEditor:"JavaScriptEvaluatorCustomEditor",customEditorMenuText:"Edit JavaScript Code",properties:{Width:{description:"width",defaultValue:200},Height:{description:"height",
defaultValue:28},inputParameters:{baseType:"JSON",defaultValue:"{}",description:'The JSON object describing the input parameters having parameter names as key and data type as value; ex. {"minTemp": "STRING"}'},code:{isVisible:!0,baseType:"STRING",isBindingTarget:!0,isEditable:!0,description:"The JavaScript code to execute"},debugMode:{isVisible:!0,baseType:"BOOLEAN",isEditable:!0,defaultValue:!1,description:"true to activate the debug"},resultType:{isVisible:!0,baseType:"STRING",isEditable:!0,description:"The (optional) result type of the executed JavaScript code",
defaultValue:"NOTHING",selectOptions:[{value:"NOTHING",text:"Nothing"},{value:"STRING",text:"String"},{value:"INTEGER",text:"Integer"},{value:"NUMBER",text:"Number"},{value:"DATETIME",text:"DateTime"},{value:"BOOLEAN",text:"Boolean"}]}}}};this.widgetServices=function(){return{Evaluate:{warnIfNotBound:!0}}};this.widgetEvents=function(){return{Evaluated:{}}};this.renderHtml=function(){return'<div class="widget-content widget-javascriptevaluator"><span class="javascriptevaluator-property">JavaScript Evaluator</span></div>'};
this.afterRender=function(){this.setProperty("_InputParametersDataShape","{}");this.addNewInputParameters(this.getProperty("inputParameters"));this.manageResultType()};this.afterSetProperty=function(a,b){"inputParameters"===a?(this.deleteOldInputParameters(),""===b?this.resetJSON(a):this.addNewInputParameters(b)||(TW.IDE.showStatusText("error","inputParameters: the JSON object is not valid, or one of the parameter names is reserved, or a type other than STRING, INTEGER, NUMBER, DATETIME, BOOLEAN, INFOTABLE has been indicated."),
this.resetJSON(a))):"resultType"===a&&this.manageResultType();return!1};this.deleteOldInputParameters=function(){var a=this.allWidgetProperties().properties,b=this.strToJson(this.getProperty("_InputParametersDataShape")),d;for(d in b)delete a[d]};this.addNewInputParameters=function(a){var b=this.allWidgetProperties().properties;a=this.strToJson(a);var d="STRING INTEGER NUMBER DATETIME BOOLEAN INFOTABLE".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&b[c]||-1===d.indexOf(a[c]))return this.setProperty("_InputParametersDataShape",
"{}"),!1;for(c in a)b[c]={isBaseProperty:!1,name:c,type:"property",isVisible:!0,isBindingTarget:!0,baseType:a[c]},"STRING"===a[c]&&(b[c].isLocalizable=!0);this.setProperty("_InputParametersDataShape",this.jsonToStr(this.getProperty("inputParameters")));this.updatedProperties({updateUI:!0});return!0};this.jsonToStr=function(a){a?"string"!==typeof a&&(a=JSON.stringify(a)):a="{}";return a};this.strToJson=function(a){a?"string"===typeof a&&(a=JSON.parse(a)):a={};return a};this.resetJSON=function(a){this.setProperty(a,
"{}");TW.IDE.updateWidgetPropertiesWindow()};this.manageResultType=function(){var a=this.allWidgetProperties().properties;delete a.result;var b=this.getProperty("resultType");"NOTHING"!==b&&(a.result={isBaseProperty:!1,name:"result",type:"property",isVisible:!0,isEditable:!1,isBindingSource:!0,baseType:b,description:"The (optional) result of the executed JavaScript code"});this.updatedProperties({updateUI:!0})}};